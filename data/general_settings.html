<!DOCTYPE html>
<html>

<head>
  <title>UI Settings</title>
  <link rel="stylesheet" type="text/css" href="style.css">
  <meta charset="utf-8" />
</head>

<body>
  <form>
    <table class="inlineTable" id="settingsTable">
      <tr>
        <td>Set Time</td>
        <td><button onclick="setTime(false)">
            To System Time
          </button></td>
        <td><button onclick="setTime(true)">
            To Custom Time
          </button></td>
      </tr>
      <tr>
        <td>Set Date</td>
        <td><button onclick="setDate(false)">
            To System Date
          </button></td>
        <td><button onclick="setDate(true)">
            To Custom Date
          </button></td>
      </tr>
    </table>
  </form>
  <script>
    function setTime(custom) {
      var date = new Date();
      var hours;
      var minutes;
      var seconds;

      if (custom) {
        var custom_time;
        while (custom_time == null) {
          custom_time = prompt("Set to (24hr time)", "hh:mm:ss");

          if (custom_time == null)
            return;

          custom_time = custom_time.match(/\b([0-1]?\d|2[0-3])\:[0-5]?\d\:[0-5]?\d\b/);
        }

        custom_time = custom_time[0]

        hours = custom_time.substring(0, custom_time.indexOf(":"));
        minutes = custom_time.substring(custom_time.indexOf(":") + 1, custom_time.lastIndexOf(":"));
        seconds = custom_time.substring(custom_time.lastIndexOf(":") + 1);
        confirm("Set to " + hours + ":" + minutes + ":" + seconds);
      } else if (confirm("Set to " + date.toTimeString().slice(0, 8)) == false) {
        return;
      }

      xhttp = new XMLHttpRequest();
      xhttp.open("POST", "/set_time", true);

      if (custom) {
        xhttp.send("hours=" + hours + "&minutes=" + minutes + "&seconds=" + seconds);
      } else {
        xhttp.send("hours=" + date.getHours() + "&minutes=" + date.getMinutes() + "&seconds=" + date.getSeconds());
      }
    }
    function setDate(custom) {
      var date = new Date();

      if (custom) {
        var custom_time;
        while (custom_time == null) {
          custom_time = prompt("Set to", "yy/mm/dd");

          if (custom_time == null)
            return;

          custom_time = custom_time.match(/\b\d\d\/(0?\d|1[0-2])\/([0-2]?\d|3[0-2])\b/);
        }

        custom_time = custom_time[0]

        date.setFullYear("20" + custom_time.substring(0, custom_time.indexOf("/")),
          custom_time.substring(custom_time.indexOf("/") + 1, custom_time.lastIndexOf("/")),
          custom_time.substring(custom_time.lastIndexOf("/") + 1));
        confirm("Set to " + date.getFullYear() + "/" + date.getMonth() + "/" + date.getDay());
      } else if (confirm("Set to (yy/mm/dd) " + date.getFullYear() + "/" + date.getMonth() + "/" + date.getDay()) == false) {
        return;
      }

      xhttp = new XMLHttpRequest();
      xhttp.open("POST", "/set_time", true);
      xhttp.send("year=" + date.getFullYear() + "&month=" + date.getMonth() + "&day=" + date.getDay());
    }
  </script>
</body>

</html>